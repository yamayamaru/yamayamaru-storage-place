#include <stdio.h>
#include "msxalib.h"
#include "msxclib.h"

#define PHIDE   0
#define PFACE   1
#define PBODY   2
#define PBOO    3
#define PKYU    4

#define SFACE1  0
#define SBODY1  1
#define SBODY2  2
#define SBOO    3
#define SFACE2  4
#define SHIDE   5
#define SKYU    6

#define HUP     0
#define HDOWN   8

int Molex[10] = { 24,96,168,62,134,32,104,176,56,128 };
int Moley[10] = { 50,50,50,90,90,130,130,130,170,170 };

struct {
    int  st;
    int  ct;
} Mole[10];

unsigned char Hmst;
unsigned char Hmct;
int  Hmx;
int  Hmy;

int  Score;

void initscrn(void);
void initspr(void);
void cpymole(void);
void cpyhammer(void);
void drawmole(int i);
void movemole(void);
void drawhammer(void);
void transfer(void);
void hammer(void);
void prnscore(void);
void subjudge(int i);
void judge(void);
void starting(void);
void game(void);
void ending(void);


void initscrn(void)
{
    ginit();
    gicini();
    color(15, 12, 12);
    screen(5);
    palett(6, 5, 3, 0);
}



void initspr(void)
{
    static char clspr1[16] = {
        1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1 };

    static char clspr2[16]= {
        14+64,14+64,14+64,14+64,14+64,14+64,14+64,14+64,
        14+64,14+64,14+64,14+64,14+64,14+64,14+64,14+64 };

    static char ptspr1[32] = {
          3,  7, 15, 15, 15, 15, 15, 15,
         15, 15, 15,  4,  3,  1,  1,  1,
        224,240,232,232,104,168,  8,232,
        216,200,136, 16,224, 64, 64,192 };

    static char ptspr2[32] = {
          0,  3,  7,  6,  6,  7,  7,  4,
          3,  7,  7,  7,  0,  0,  0,  0,
          0,224,112,176,176,112,240, 16,
        224,240,240,224,  0,128,128,  0 };

    static char ptspr3[32] = {
          3,  7, 15, 15, 15, 12, 15, 15,
         15, 15, 15,  7,  3,  1,  1,  0,
        224,240,248,248,232,  8,136,232,
        104, 72, 72, 80, 96, 64,192,  0 };

    static char ptspr4[32] = {
          0,  3,  7,  3,  4,  7,  7,  7,
          6,  6,  6,  2,  0,  0,  0,  0,
          0,224,240,224, 16,240,240,112,
        176,176,176,160,128,128,  0,  0 };

    inispr(3);
    sprite(0, ptspr1);
    sprite(4, ptspr2);
    sprite(8, ptspr3);
    sprite(12, ptspr4);
    colspr(0, clspr1);
    colspr(1, clspr2);
}



    static char ptmole[5][1284] = {

      { 32,  0, 32,  0,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,12,12,12,12,12,
        12, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,12,12,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,12,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,12,
        12, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,12,12,
        12,12,12, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,12,12,12,12,
        12,12,12,12,12,12, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 1, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1,12,12,12,12,12,12,12,12,12,12,12 },

      { 32,  0, 32,  0,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12, 1,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12, 1, 1,12, 1,
        12,12, 1, 1,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12, 1, 1,
        12, 1,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12, 1,
         1,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12, 1, 1, 1, 1,
         1, 1, 1,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12, 1, 1, 6, 6, 6, 6,
         6, 6, 6, 1, 1,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,
        12,12,12,12, 1, 1, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1,12,12,12,12,
        12, 1, 1, 1, 1, 1, 1, 6, 6, 6, 6, 1, 1, 6, 6, 6,
         6, 6, 1, 1, 6, 6, 6, 6, 1, 1, 1, 1, 1, 1,12,12,
         1, 1, 1, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 1, 1, 1,12,
         1, 1, 1, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 1, 1, 1,12,
        12, 1, 1, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 1, 1,12,12,
        12,12,12, 1, 1, 1, 1, 1, 6, 6, 1,15,15, 1, 6, 6,
         6, 1,15,15, 1, 6, 6, 1, 1, 1, 1, 1,12,12,12,12,
        12,12,12,12,12,12, 1, 1, 1, 1, 1,15,15, 1, 6, 6,
         6, 1,15,15, 1, 1, 1, 1, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1,12,12,12,12,12,12,12,12,12,12,12 },

      { 32,  0, 32,  0,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12, 1,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12, 1, 1,12, 1,
        12,12, 1, 1,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12, 1, 1,
        12, 1,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12, 1,
         1,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12, 1, 1, 1, 1,
         1, 1, 1,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12, 1, 1, 6, 6, 6, 6,
         6, 6, 6, 1, 1,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 6, 1, 1, 6, 6, 6,
         6, 6, 1, 1, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12, 1, 6, 6, 6, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12,12,12,12, 1, 6, 6, 6, 6, 1, 1, 1, 6, 6, 6,
         6, 1, 1, 1, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12,12, 1, 1, 1, 6, 6, 6, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 6, 1, 1, 1,12,12,12,12,
        12,12,12,12,12, 1, 1, 1, 6, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 1, 1,12,12,12,12,12,12,
        12,12, 1, 1, 1, 6, 6, 6, 1, 6, 1, 1, 1, 1, 6, 6,
         6, 1, 1, 1, 1, 6, 1, 1, 6, 1, 1, 1, 1,12,12,12,
        12,12,12, 1, 6, 6, 6, 6, 1, 1, 6, 1, 1, 6, 6, 6,
         6, 6, 1, 1, 6, 1, 6, 6, 1, 1,12,12,12,12,12,12,
        12,12,12, 1, 6, 6, 6, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 1, 1, 6, 1,12,12,12,12,12,12,
        12,12, 1, 6, 6, 1, 1, 6, 1, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12, 1, 6, 6, 6, 6, 6, 1, 6, 1, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 1, 6, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12, 1, 6, 6, 1, 6, 1, 6, 6, 6, 1, 6, 6, 6, 6,
         6, 6, 6, 1, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12, 1, 6, 6, 6, 1, 6, 6, 6, 6, 6, 1, 1, 6, 6,
         6, 1, 1, 6, 6, 6, 6, 6, 6, 1, 1, 1,12,12,12,12,
        12, 1, 1, 6, 6, 6, 1, 6, 6, 6, 6, 6, 6, 6, 1, 1,
         1, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1,12,12,
         1, 1, 1, 6, 6, 6, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1, 1,12,
         1, 1, 1, 6, 6, 6, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1, 1,12,
        12, 1, 1, 1, 6, 6, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1,12,12,
        12,12,12, 1, 1, 1, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1,12,12,12,12,
        12,12,12,12,12,12, 1, 1, 1, 1, 1, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 1, 1, 1, 1, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1,12,12,12,12,12,12,12,12,12,12,12 },

      { 32,  0, 32,  0,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12, 1,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12, 1,
        12,12,12, 1,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12, 1, 1,12, 1,
        12, 1, 1,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12, 1,12,12, 1, 1,
         1,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12, 1, 1, 1, 1,
         1, 1, 1,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12, 1, 1, 6, 6, 6, 6,
         6, 6, 6, 1, 1,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 6, 6,15,15,15, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 6,15,15,15,15, 6,
         6, 6,15,15, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6,15,15,15,15, 6, 6,
         6,15,15, 1, 1, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12, 1, 6, 6, 6, 6,15, 1, 1, 1, 6, 6,
         6,15,15, 1, 1, 1, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12,12,12,12, 1, 6, 6, 6,15, 1, 1, 1, 1, 6, 6,
         6,15,15,15, 1, 1, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12,12, 1, 1, 1, 6, 6, 6,15, 1, 1, 1, 6, 6, 6,
         6, 6,15,15,15,15,15, 6, 6, 1, 1, 1,12,12,12,12,
        12,12,12,12,12, 1, 1, 6, 6,15,15,15, 6, 6, 6, 6,
         6, 6, 6,15,15,15,15, 6, 1, 1,12,12,12,12,12,12,
        12,12, 1, 1, 1, 1, 6, 1, 1,15,15,15, 6, 6, 6, 6,
         6, 6, 6, 6, 6,15, 1, 1, 6, 1, 1, 1, 1,12,12,12,
        12,12,12,12,12, 1, 1, 6, 6, 1, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 1, 6, 6, 1, 1,12,12,12,12,12,12,
        12,12,12,12,12, 1, 6, 1, 1, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 1, 1, 6, 1,12,12,12,12,12,12,
        12,12,12,12,12, 1, 6, 6, 6, 6, 1, 1, 6, 6, 6, 6,
         6, 6, 1, 1, 1, 6, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12,12,12, 1, 1, 1, 6, 6, 1, 1, 1, 1, 1, 6, 6,
         1, 1, 1, 1, 1, 1, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12,12, 1, 6, 6, 6, 1, 6, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12, 1, 6, 6, 6, 6, 1, 6, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1,12,12,12,12,
        12, 1, 1, 6, 6, 6, 1, 6, 6, 6, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 6, 6, 6, 6, 1, 1, 1, 1, 1,12,12,
         1, 1, 6, 6, 1, 1, 6, 1, 6, 6, 6, 1, 1, 1, 1, 8,
         8, 8, 8, 1, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1, 1,12,
         1, 1, 6, 6, 6, 6, 6, 1, 6, 6, 6, 6, 6, 1, 8, 8,
         8, 8, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1, 1,12,
        12, 1, 1, 6, 6, 6, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1,12,12,
        12,12,12, 1, 1, 1, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1,12,12,12,12,
        12,12,12,12,12,12, 1, 1, 1, 1, 1, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 1, 1, 1, 1, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1,12,12,12,12,12,12,12,12,12,12,12 },

      { 32,  0, 32,  0,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12, 8,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,10,10,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12, 8,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,10,12,12,12,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,
        12,12,10,10,10,12,12,12,12,12,12, 8,12,12,12,12,
         8,12,12,12,12,15,12,12,12,12,15,12,12,12,12,12,
        12,10,12,12,10,10,12,12,12,12,12,12,12,12,12, 1,
        12,12,12,12,15,15,15,12,12,15,15,15,12,12,12,12,
        10,12,12,10,12,10,12,12,12,12,12, 1, 1,12,12, 1,
        12,12, 1, 1,12,15,15,15,15,15,15,12,12,12,12,12,
        12,10,10,12,10,10,10,12,12,12,12,12,12, 1,12, 1,
        12, 1,12,12,12,12,15,15,15,15, 1, 1, 1, 1, 1, 1,
        12,12,12,10,12,12,10,12,12,12,12,12, 1, 1, 1, 1,
         1, 1, 1,12,12,12,15,15,15,15,12,12,12,12,12,12,
        12,12,10,12,12,10,12,10,12,12, 1, 1, 6, 6, 6, 6,
         6, 6, 6, 1,12,15,15,15,15,15,15,12,12,12,12,12,
        12,12,12,10,10,12,12,10,12, 1, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6,15,15,15,12,12,15,15,15,12,12,12,12,
        12,12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6,15, 1,12,12,12,15,12,12,12,12,12,
        12,12,12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12, 1, 6, 6, 6, 1, 1, 6, 6, 6,
         6, 6,15,15, 6, 6, 6, 1,12,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 1, 1, 1, 1, 6, 6,
         6,15,15,15,15, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6,15, 1, 1,15, 6, 6,
         6,15, 1, 1,15, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6,15,15,15,15, 6, 6,
         6, 1, 1, 1, 1, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12, 1, 6, 6, 6, 6,15,15, 6, 6, 6,
         6, 6, 1, 1, 6, 6, 6, 6, 1,12,12,12,12,12,12,12,
        12,12,12,12,12, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 6, 6, 1,12,12,12,12,12,12,
        12,12,12,12,12, 1, 1, 1, 6, 6, 6, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 6, 6, 6, 1, 1, 1,12,12,12,12,12,12,
        12,12,12,12, 1, 1, 6, 6, 1, 6, 6, 6,15, 1, 1, 1,
         1, 1,15, 6, 6, 6, 1, 6, 6, 1, 1,12,12,12,12,12,
        12,12,12, 1,12, 1, 1, 1, 6, 6, 1,15,15, 1, 1, 1,
         1, 1,15,15, 1, 6, 6, 1, 1, 1,12, 1,12,12,12,12,
        12,12,12,12, 1, 1, 6, 6, 6, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 6, 6, 6, 1, 1,12,12,12,12,12,
        12,12,12, 1,12, 1, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 6, 6, 1,12, 1,12,12,12,12,
        12,12,12, 1, 1, 1, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 6, 6, 1, 1, 1,12,12,12,12,
        12, 1, 1, 1, 1, 1, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 6, 6, 1, 1, 1, 1, 1,12,12,
         1, 1, 1, 1, 1, 1, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 1, 6, 6, 1, 1, 1, 1, 1, 1,12,
         1, 1, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1, 1, 6, 6, 6, 1, 1, 1, 1, 1, 1,12,
        12, 1, 1, 1, 1, 1, 6, 6, 6, 6, 1, 1, 1, 8, 8, 1,
         8, 8, 1, 1, 1, 6, 6, 6, 6, 1, 1, 1, 1, 1,12,12,
        12,12,12, 1, 1, 1, 1, 6, 6, 6, 6, 6, 8, 8, 8, 8,
         1, 8, 8, 6, 6, 6, 6, 6, 1, 1, 1, 1,12,12,12,12,
        12,12,12,12,12,12, 1, 1, 1, 1, 1, 6, 6, 6, 6, 6,
         6, 6, 6, 6, 1, 1, 1, 1, 1,12,12,12,12,12,12,12,
        12,12,12,12,12,12,12,12,12,12, 1, 1, 1, 1, 1, 1,
         1, 1, 1, 1, 1,12,12,12,12,12,12,12,12,12,12,12 } };

void cpymole(void)
{
    int i;

    for (i= 0; i < 5; ++i)
        cpym2v(ptmole[i], 0, i * 32, 0, 1, 0);
}

void cpyhammer(void)
{
    static char pthit[53] = { 7,  0,  7,  0,
        12,12,12,15,12,12,12,15,15,15,15,15,15,14,
        15,15,15,15,15,15,14,15,15,14,14,14,14,14,
        12,12,12,15,12,12,12,12,12,12,15,12,12,12,
        12,12,12,15,12,12,12 };

    cpym2v(pthit, 0, 160, 0, 1, 0);
}

void drawmole(int i)
{
    static int pat[7] = {
        PFACE, PBODY, PBODY, PBOO, PFACE, PHIDE, PKYU };
    int x;

    x = pat[Mole[i].st] * 32;
    cpyv2v(x, 0, x+31, 31, 1, Molex[i], Moley[i], 0, 0);
}

void movemole(void)
{
    int i, next = 0;
    static int act[3] = { SBODY1, SBODY2, SHIDE };
    static int wt[6] = { 5, 12, 10,  6,  8, 25};
    static int wr[6] = {10,  8,  1, 14,  1, 95};

    for (i = 0; i < 10; ++i) {
        if (--Mole[i].ct == 0) {
            switch (Mole[i].st) {
             case SFACE1:  next = act[rnd(3)]; break;
             case SBODY1:  next = SFACE2;      break;
             case SBODY2:  next = SBOO;        break;
             case SBOO:    next = SFACE2;      break;
             case SFACE2:  next = SHIDE;       break;
             case SHIDE:   next = SFACE1;      break;
             case SKYU:    next = SFACE2;      break;
            }
            Mole[i].st = next;
            Mole[i].ct = wt[next] + rnd(wr[next]);
            drawmole(i);
        }
    }
}

void drawhammer(void)
{
    putspr(0, Hmx, Hmy, 0, Hmst);
    putspr(1, Hmx, Hmy, 0, Hmst + 4);
}

void transfer(void)
{
    static int trnx[8] = { 0, 8, 10, 8, 0, -8, -10, -8 };
    static int trny[8] = { -10, -8, 0, 8, 10, 8, 0, -8 };
    unsigned char i;

    if ((i = gtstck(0)) != 0) {
        Hmx += trnx[i-1];
        Hmy += trny[i-1];
    }
    else {
        gtpad(12);
        Hmx += gtpad(13)/2;
        Hmy += gtpad(14)/2;
    }

    if (Hmx < 8)   Hmx = 8;
    if (Hmx > 216) Hmx = 216;
    if (Hmy < 8)   Hmy = 8;
    if (Hmy > 174) Hmy = 174;
}

void hammer(void)
{
    if (Hmst == HUP) {
        transfer();
        if (gttrig(0) || gttrig(1)) {
            Hmst = HDOWN;
            Hmct = 3;
        }
    }
    else {
        if (--Hmct == 0) {
            Hmst = HUP;
            gtpad(12);
        }
    }
    drawhammer();
}

void prnscore(void)
{
    int x, y;

    y = ((Score - 1) / 20) * 8;
    x = ((Score - 1) % 20) * 8;
    if (x > 9*8) x += 8;
    cpyv2v(160, 0, 166, 6, 1, 48+x, y, 0, 0);
}

void subjudge(int i)
{
    if (Hmx < Molex[i] - 15) return;
    if (Hmx > Molex[i] + 15) return;
    if (Hmy < Moley[i] - 20) return;
    if (Hmy > Moley[i] - 6)  return;

    Mole[i].st = SKYU;
    Mole[i].ct = 12;
    ++Score;
    drawmole(i);
    prnscore();

    sound(0, 64);
    sound(1, 1);
    sound(6, 24);
    sound(7, 182);
    sound(8, 16);
    sound(11, 0);
    sound(12, 20);
    sound(13, 0);
}

void judge(void)
{
    int i, s;

    if (Hmst == HDOWN) {
        for (i = 0; i < 10; ++i) {
            s = Mole[i].st;
            if (s == SBODY1 || s == SBODY2 || s == SBOO)
                subjudge(i);
        }
    }
}

void starting(void)
{
    int i;

    srnd();
    Hmx = 120;
    Hmy = 100;
    Hmst = HUP;
    Hmct = 0;
    Score = 0;

    for (i = 0; i < 10; ++i) {
        Mole[i].st = SHIDE;
        Mole[i].ct = rnd(100);
        drawmole(i);
    }

    drawhammer();
    boxfil(224, 40, 233, 189, 10, 0);
}

void game(void)
{
    int i, j, wait;

    for (i = 0; i < 150; ++i) {
        line(224, 40 + i, 233, 40 + i, 1, 0);
        for (j = 0; j < 10; ++j) {
            hammer();
            movemole();
            judge();
            for (wait = 0; wait < 1000; ++wait);
        }
    }
}

void ending(void)
{
    int wait, loop;

    for (loop = 9; loop > 0; --loop) {
        palett(12, 6, 1, 1);
        for (wait = 0; wait < 1000; ++wait);
        sound(0, 29 + loop * 24);
        sound(1, 1);
        sound(7, 190);
        sound(8, 16);
        sound(11, 0);
        sound(12, 24);
        sound(13, 0);
        palett(12, 1, 4, 1);
        for (wait = 0; wait < 1000; ++wait);
    }

    while (!gttrig(0) && !gttrig(1));
}

int main(void)
{
    initscrn();
    initspr();
    cpymole();
    cpyhammer();
    starting();
    game();
    ending();
    kilbuf();
    color(15, 1, 1);
    screen(0);
    printf("your score: %6d\n", Score);

	return 0;
}

